#!/bin/bash
# âš”ï¸ multi-agent-ff15 Stand by Me ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ¯æ—¥ã®èµ·å‹•ç”¨ï¼‰
# Daily Deployment Script for Multi-Agent Orchestration System
#
# ä½¿ç”¨æ–¹æ³•:
#   ./standby.sh           # å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•ï¼ˆå‰å›ã®çŠ¶æ…‹ã‚’ç¶­æŒï¼‰
#   ./standby.sh -c        # ã‚­ãƒ¥ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦èµ·å‹•ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰
#   ./standby.sh -s        # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ã¿ï¼ˆOpenCodeèµ·å‹•ãªã—ï¼‰
#   ./standby.sh -h        # ãƒ˜ãƒ«ãƒ—è¡¨ç¤º

set -e

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

# è¨€èªè¨­å®šã‚’èª­ã¿å–ã‚Šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: jaï¼‰
LANG_SETTING="ja"
if [ -f "./config/settings.yaml" ]; then
    LANG_SETTING=$(grep "^language:" ./config/settings.yaml 2>/dev/null | awk '{print $2}' || echo "ja")
fi

# ã‚·ã‚§ãƒ«è¨­å®šã‚’èª­ã¿å–ã‚Šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: bashï¼‰
SHELL_SETTING="bash"
if [ -f "./config/settings.yaml" ]; then
    SHELL_SETTING=$(grep "^shell:" ./config/settings.yaml 2>/dev/null | awk '{print $2}' || echo "bash")
fi

# è‰²ä»˜ããƒ­ã‚°é–¢æ•°ï¼ˆFF15é¢¨ï¼‰
log_info() {
    echo -e "\033[1;33m[INFO]\033[0m $1"
}

log_success() {
    echo -e "\033[1;32m[OK]\033[0m $1"
}

log_war() {
    echo -e "\033[1;31m[>>]\033[0m $1"
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆé–¢æ•°ï¼ˆbash/zshå¯¾å¿œï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ä½¿ç”¨æ³•: generate_prompt "ãƒ©ãƒ™ãƒ«" "è‰²" "ã‚·ã‚§ãƒ«"
# è‰²: red, green, blue, magenta, cyan, yellow
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
generate_prompt() {
    local label="$1"
    local color="$2"
    local shell_type="$3"

    if [ "$shell_type" == "zsh" ]; then
        # zshç”¨: %F{color}%B...%b%f å½¢å¼
        echo "(%F{${color}}%B${label}%b%f) %F{green}%B%~%b%f%# "
    else
        # bashç”¨: \[\033[...m\] å½¢å¼
        local color_code
        case "$color" in
            red)     color_code="1;31" ;;
            green)   color_code="1;32" ;;
            yellow)  color_code="1;33" ;;
            blue)    color_code="1;34" ;;
            magenta) color_code="1;35" ;;
            cyan)    color_code="1;36" ;;
            *)       color_code="1;37" ;;  # white (default)
        esac
        echo "(\[\033[${color_code}m\]${label}\[\033[0m\]) \[\033[1;32m\]\w\[\033[0m\]\$ "
    fi
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³è§£æ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SETUP_ONLY=false
OPEN_TERMINAL=false
CLEAN_MODE=false
MODE="normal"
SHELL_OVERRIDE=""
MODE_CONFIG_FILE="./config/models.yaml"

while [[ $# -gt 0 ]]; do
    case $1 in
        -s|--setup-only)
            SETUP_ONLY=true
            shift
            ;;
        -c|--clean)
            CLEAN_MODE=true
            shift
            ;;
        --fullpower)
            if [ "$MODE" != "normal" ]; then
                echo "ã‚¨ãƒ©ãƒ¼: ãƒ¢ãƒ¼ãƒ‰ã¯1ã¤ã®ã¿æŒ‡å®šã§ãã¾ã™"
                exit 1
            fi
            MODE="fullpower"
            shift
            ;;
        --lite)
            if [ "$MODE" != "normal" ]; then
                echo "ã‚¨ãƒ©ãƒ¼: ãƒ¢ãƒ¼ãƒ‰ã¯1ã¤ã®ã¿æŒ‡å®šã§ãã¾ã™"
                exit 1
            fi
            MODE="lite"
            shift
            ;;
        --free-kimi)
            if [ "$MODE" != "normal" ]; then
                echo "ã‚¨ãƒ©ãƒ¼: ãƒ¢ãƒ¼ãƒ‰ã¯1ã¤ã®ã¿æŒ‡å®šã§ãã¾ã™"
                exit 1
            fi
            MODE="free-kimi"
            shift
            ;;
        --free-glm)
            if [ "$MODE" != "normal" ]; then
                echo "ã‚¨ãƒ©ãƒ¼: ãƒ¢ãƒ¼ãƒ‰ã¯1ã¤ã®ã¿æŒ‡å®šã§ãã¾ã™"
                exit 1
            fi
            MODE="free-glm"
            shift
            ;;
        -t|--terminal)
            OPEN_TERMINAL=true
            shift
            ;;
        -shell|--shell)
            if [[ -n "$2" && "$2" != -* ]]; then
                SHELL_OVERRIDE="$2"
                shift 2
            else
                echo "ã‚¨ãƒ©ãƒ¼: -shell ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¯ bash ã¾ãŸã¯ zsh ã‚’æŒ‡å®šã—ã¦ãã ã•ã„"
                exit 1
            fi
            ;;
        -h|--help)
            echo ""
            echo "âš”ï¸ multi-agent-ff15 Stand by Me ã‚¹ã‚¯ãƒªãƒ—ãƒˆ"
            echo ""
            echo "ä½¿ç”¨æ–¹æ³•: ./standby.sh [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]"
            echo ""
            echo "ã‚ªãƒ—ã‚·ãƒ§ãƒ³:"
            echo "  -c, --clean         ã‚­ãƒ¥ãƒ¼ã¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦èµ·å‹•ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰"
            echo "                      æœªæŒ‡å®šæ™‚ã¯å‰å›ã®çŠ¶æ…‹ã‚’ç¶­æŒã—ã¦èµ·å‹•"
            echo "  --fullpower         Full Powerãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•"
            echo "  --lite              Liteãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•"
            echo "  --free-kimi         ç„¡æ–™ãƒ¢ãƒ¼ãƒ‰ï¼ˆKimi K2.5ï¼‰ã§èµ·å‹•"
            echo "  --free-glm          ç„¡æ–™ãƒ¢ãƒ¼ãƒ‰ï¼ˆGLM 4.7ï¼‰ã§èµ·å‹•"
            echo "  -s, --setup-only    tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ã¿ï¼ˆOpenCodeèµ·å‹•ãªã—ï¼‰"
            echo "  -t, --terminal      Windows Terminal ã§æ–°ã—ã„ã‚¿ãƒ–ã‚’é–‹ã"
            echo "  -shell, --shell SH  ã‚·ã‚§ãƒ«ã‚’æŒ‡å®šï¼ˆbash ã¾ãŸã¯ zshï¼‰"
            echo "                      æœªæŒ‡å®šæ™‚ã¯ config/settings.yaml ã®è¨­å®šã‚’ä½¿ç”¨"
            echo "  -h, --help          ã“ã®ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º"
            echo ""
            echo "ä¾‹:"
            echo "  ./standby.sh              # å‰å›ã®çŠ¶æ…‹ã‚’ç¶­æŒã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ"
            echo "  ./standby.sh -c           # ã‚¯ãƒªãƒ¼ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆã‚­ãƒ¥ãƒ¼ãƒªã‚»ãƒƒãƒˆï¼‰"
            echo "  ./standby.sh -s           # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ã¿ï¼ˆæ‰‹å‹•ã§OpenCodeèµ·å‹•ï¼‰"
            echo "  ./standby.sh -t           # å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹• + ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¿ãƒ–å±•é–‹"
            echo "  ./standby.sh -shell bash  # bashç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§èµ·å‹•"
            echo "  ./standby.sh --fullpower  # Full Powerãƒ¢ãƒ¼ãƒ‰ã§ã‚¹ã‚¿ãƒ¼ãƒˆ"
            echo "  ./standby.sh --lite       # Liteãƒ¢ãƒ¼ãƒ‰ã§ã‚¹ã‚¿ãƒ¼ãƒˆ"
            echo "  ./standby.sh --free-kimi  # ç„¡æ–™ãƒ¢ãƒ¼ãƒ‰ï¼ˆKimi K2.5ï¼‰ã§ã‚¹ã‚¿ãƒ¼ãƒˆ"
            echo "  ./standby.sh --free-glm   # ç„¡æ–™ãƒ¢ãƒ¼ãƒ‰ï¼ˆGLM 4.7ï¼‰ã§ã‚¹ã‚¿ãƒ¼ãƒˆ"
            echo "  ./standby.sh -c --fullpower  # ã‚¯ãƒªãƒ¼ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼‹Full Powerãƒ¢ãƒ¼ãƒ‰"
            echo "  ./standby.sh -shell zsh   # zshç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§èµ·å‹•"
            echo ""
            echo "ãƒ¢ãƒ‡ãƒ«æ§‹æˆ:"
            echo "  config/models.yaml ã‚’å‚ç…§"
            echo ""
            echo "ãƒ¢ãƒ¼ãƒ‰æ§‹æˆ:"
            echo "  Normalï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰:    æ¨™æº–æ§‹æˆ"
            echo "  Full Powerï¼ˆ--fullpowerï¼‰: é«˜æ€§èƒ½æ§‹æˆ"
            echo "  Liteï¼ˆ--liteï¼‰:           ä½ã‚³ã‚¹ãƒˆæ§‹æˆ"
            echo "  Free Kimiï¼ˆ--free-kimiï¼‰: ç„¡æ–™ï¼ˆKimi K2.5ï¼‰"
            echo "  Free GLMï¼ˆ--free-glmï¼‰:   ç„¡æ–™ï¼ˆGLM 4.7ï¼‰"
            echo ""
            echo "ã‚¨ã‚¤ãƒªã‚¢ã‚¹:"
            echo "  csnt  â†’ cd /mnt/c/tools/multi-agent-ff15 && ./standby.sh"
            echo "  csn   â†’ tmux attach-session -t noctis"
            echo "  csk   â†’ tmux attach-session -t kingsglaive"
            echo ""
            exit 0
            ;;
        *)
            echo "ä¸æ˜ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³: $1"
            echo "./standby.sh -h ã§ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º"
            exit 1
            ;;
    esac
done

# ã‚·ã‚§ãƒ«è¨­å®šã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³å„ªå…ˆï¼‰
if [ -n "$SHELL_OVERRIDE" ]; then
    if [[ "$SHELL_OVERRIDE" == "bash" || "$SHELL_OVERRIDE" == "zsh" ]]; then
        SHELL_SETTING="$SHELL_OVERRIDE"
    else
        echo "ã‚¨ãƒ©ãƒ¼: -shell ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¯ bash ã¾ãŸã¯ zsh ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆæŒ‡å®šå€¤: $SHELL_OVERRIDEï¼‰"
        exit 1
    fi
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ãƒ¢ãƒ‡ãƒ«è¨­å®šã®èª­ã¿è¾¼ã¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ–°æ§‹é€ : modes.<mode>.<agent>.<key> (e.g. modes.normal.noctis.model)
get_mode_value() {
    local mode="$1"
    local agent="$2"
    local key="$3"

    if [ ! -f "$MODE_CONFIG_FILE" ]; then
        echo ""
        return 1
    fi

    awk -v mode="$mode" -v agent="$agent" -v key="$key" '
        $1 == "modes:" {in_modes=1; next}
        in_modes && /^  [a-zA-Z]/ && $1 == mode":" {in_mode=1; next}
        in_modes && in_mode && /^  [a-zA-Z]/ && $1 != mode":" {in_mode=0}
        in_mode && /^    [a-zA-Z]/ && $1 == agent":" {in_agent=1; next}
        in_mode && in_agent && /^    [a-zA-Z]/ && $1 != agent":" {in_agent=0}
        in_agent && $1 == key":" {
            val = $2
            for (i=3; i<=NF; i++) val = val " " $i
            print val
            exit
        }
    ' "$MODE_CONFIG_FILE"
}

require_mode_value() {
    local mode="$1"
    local agent="$2"
    local key="$3"
    local value

    value=$(get_mode_value "$mode" "$agent" "$key")
    if [ -z "$value" ]; then
        echo "ã‚¨ãƒ©ãƒ¼: ${MODE_CONFIG_FILE} ã® modes.${mode}.${agent}.${key} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        exit 1
    fi
    echo "$value"
}

case "$MODE" in
    normal) MODE_NAME="Normal" ;;
    fullpower) MODE_NAME="Full Power" ;;
    lite) MODE_NAME="Lite" ;;
    free-kimi) MODE_NAME="Free (Kimi K2.5)" ;;
    free-glm) MODE_NAME="Free (GLM 4.7)" ;;
    *)
        echo "ã‚¨ãƒ©ãƒ¼: æœªå¯¾å¿œã®ãƒ¢ãƒ¼ãƒ‰: $MODE"
        exit 1
        ;;
esac

NOCTIS_MODEL=$(require_mode_value "$MODE" "noctis" "model")
NOCTIS_LABEL=$(require_mode_value "$MODE" "noctis" "label")
IGNIS_MODEL=$(require_mode_value "$MODE" "ignis" "model")
IGNIS_LABEL=$(require_mode_value "$MODE" "ignis" "label")
GLADIOLUS_MODEL=$(require_mode_value "$MODE" "gladiolus" "model")
GLADIOLUS_LABEL=$(require_mode_value "$MODE" "gladiolus" "label")
PROMPTO_MODEL=$(require_mode_value "$MODE" "prompto" "model")
PROMPTO_LABEL=$(require_mode_value "$MODE" "prompto" "label")
LUNAFREYA_MODEL=$(require_mode_value "$MODE" "lunafreya" "model")
LUNAFREYA_LABEL=$(require_mode_value "$MODE" "lunafreya" "label")
IRIS_MODEL=$(require_mode_value "$MODE" "iris" "model")
IRIS_LABEL=$(require_mode_value "$MODE" "iris" "label")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# èµ·å‹•ãƒãƒŠãƒ¼è¡¨ç¤º
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
show_battle_cry() {
    clear

    # ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒŠãƒ¼ï¼ˆè‰²ä»˜ãï¼‰
    echo ""
    echo -e "\033[1;31mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\033[0m"
    echo -e "\033[1;31mâ•‘\033[0m \033[1;33mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—\033[0m \033[1;31mâ•‘\033[0m"
    echo -e "\033[1;31mâ•‘\033[0m \033[1;33mâ–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•\033[0m \033[1;31mâ•‘\033[0m"
    echo -e "\033[1;31mâ•‘\033[0m \033[1;33mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•     â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  \033[0m \033[1;31mâ•‘\033[0m"
    echo -e "\033[1;31mâ•‘\033[0m \033[1;33mâ•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â•šâ–ˆâ–ˆâ•”â•      â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  \033[0m \033[1;31mâ•‘\033[0m"
    echo -e "\033[1;31mâ•‘\033[0m \033[1;33mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—\033[0m \033[1;31mâ•‘\033[0m"
    echo -e "\033[1;31mâ•‘\033[0m \033[1;33mâ•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•     â•šâ•â•â•â•â•â•    â•šâ•â•       â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•\033[0m \033[1;31mâ•‘\033[0m"
    echo -e "\033[1;31mâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\033[0m"
    echo -e "\033[1;31mâ•‘\033[0m       \033[1;37mã„ããã€ã¿ã‚“ãªï¼\033[0m    \033[1;36mâš”\033[0m    \033[1;35mStand by Meï¼\033[0m                          \033[1;31mâ•‘\033[0m"
    echo -e "\033[1;31mâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\033[0m"
    echo ""

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Party Formation
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    echo -e "\033[1;34m  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\033[0m"
    echo -e "\033[1;34m  â•‘\033[0m                    \033[1;37mã€ P a r t y  ãƒ»  4  C o m r a d e s ã€‘\033[0m                        \033[1;34mâ•‘\033[0m"
    echo -e "\033[1;34m  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\033[0m"

    cat << 'PARTY_EOF'

              âš”                 ğŸ”«                 âœ¨                 ğŸŒ¸
             /|\               /|\               /|\               /|\
            / | \             / | \             / | \             / | \
              |                 |                 |                 |
             / \               / \               / \               / \
         [Gladiolus]       [Prompto]        [Lunafreya]         [Iris]

PARTY_EOF

    echo -e "                    \033[1;36mã€Œã€Œã€Œ äº†è§£ï¼ã„ã¤ã§ã‚‚æº–å‚™OKï¼ ã€ã€ã€\033[0m"
    echo ""

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    echo -e "\033[1;33m  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\033[0m"
    echo -e "\033[1;33m  â”ƒ\033[0m  \033[1;37mâš”ï¸ multi-agent-ff15\033[0m  ã€œ \033[1;36mFF15ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçµ±ç‡ã‚·ã‚¹ãƒ†ãƒ \033[0m ã€œ           \033[1;33mâ”ƒ\033[0m"
    echo -e "\033[1;33m  â”ƒ\033[0m                                                                           \033[1;33mâ”ƒ\033[0m"
    echo -e "\033[1;33m  â”ƒ\033[0m    \033[1;35mNoctis\033[0m: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±æ‹¬    \033[1;31mIgnis\033[0m: ã‚¿ã‚¹ã‚¯ç®¡ç†    \033[1;34mComrades\033[0m: å®Ÿåƒéƒ¨éšŠÃ—4         \033[1;33mâ”ƒ\033[0m"
    echo -e "\033[1;33m  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\033[0m"
    echo ""
}

# ãƒãƒŠãƒ¼è¡¨ç¤ºå®Ÿè¡Œ
show_battle_cry

echo -e "  \033[1;33mStand by Meï¼ãƒ‘ãƒ¼ãƒ†ã‚£ç·¨æˆã‚’é–‹å§‹\033[0m (Setting up the battlefield)"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 1: æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
log_info "ğŸ§¹ æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ä¸­..."
tmux kill-session -t kingsglaive 2>/dev/null && log_info "  â””â”€ kingsglaiveã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ã‚¯ãƒªã‚¢å®Œäº†" || log_info "  â””â”€ kingsglaiveã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯å­˜åœ¨ã›ãš"
tmux kill-session -t noctis 2>/dev/null && log_info "  â””â”€ noctisã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ã‚¯ãƒªã‚¢å®Œäº†" || log_info "  â””â”€ noctisã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯å­˜åœ¨ã›ãš"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 1.5: å‰å›è¨˜éŒ²ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆ--cleanæ™‚ã®ã¿ã€å†…å®¹ãŒã‚ã‚‹å ´åˆï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if [ "$CLEAN_MODE" = true ]; then
    BACKUP_DIR="./logs/backup_$(date '+%Y%m%d_%H%M%S')"
    NEED_BACKUP=false

    if [ -f "./dashboard.md" ]; then
        if grep -q "cmd_" "./dashboard.md" 2>/dev/null; then
            NEED_BACKUP=true
        fi
    fi

    # æ—¢å­˜ã® dashboard.md åˆ¤å®šã®å¾Œã«è¿½åŠ 
    if [ -f "./queue/noctis_to_ignis.yaml" ]; then
        if grep -q "id: cmd_" "./queue/noctis_to_ignis.yaml" 2>/dev/null; then
            NEED_BACKUP=true
        fi
    fi

    if [ "$NEED_BACKUP" = true ]; then
        mkdir -p "$BACKUP_DIR" || true
        cp "./dashboard.md" "$BACKUP_DIR/" 2>/dev/null || true
        cp -r "./queue/reports" "$BACKUP_DIR/" 2>/dev/null || true
        cp -r "./queue/tasks" "$BACKUP_DIR/" 2>/dev/null || true
        cp "./queue/noctis_to_ignis.yaml" "$BACKUP_DIR/" 2>/dev/null || true
        log_info "ğŸ“¦ å‰å›ã®è¨˜éŒ²ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $BACKUP_DIR"
    fi
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 2: ã‚­ãƒ¥ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºä¿ + ãƒªã‚»ãƒƒãƒˆï¼ˆ--cleanæ™‚ã®ã¿ãƒªã‚»ãƒƒãƒˆï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# queue ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆï¼ˆåˆå›èµ·å‹•æ™‚ã«å¿…è¦ï¼‰
[ -d ./queue/reports ] || mkdir -p ./queue/reports
[ -d ./queue/tasks ] || mkdir -p ./queue/tasks

if [ "$CLEAN_MODE" = true ]; then
    log_info "ğŸ“œ å‰å›ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ²ã‚’ç ´æ£„ä¸­..."

    # Comrade task file reset
    for WORKER_NAME in gladiolus prompto lunafreya iris; do
        cat > ./queue/tasks/${WORKER_NAME}.yaml << EOF
# ${WORKER_NAME} task file
task:
  task_id: null
  parent_cmd: null
  description: null
  target_path: null
  status: idle
  timestamp: ""
EOF
    done

    # Comrade report file reset
    for WORKER_NAME in gladiolus prompto lunafreya iris; do
        cat > ./queue/reports/${WORKER_NAME}_report.yaml << EOF
worker_id: ${WORKER_NAME}
task_id: null
timestamp: ""
status: idle
result: null
EOF
    done

    log_success "âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†"
else
    log_info "ğŸ“œ å‰å›ã®çŠ¶æ…‹ã‚’ç¶­æŒã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ..."
    log_success "âœ… ã‚­ãƒ¥ãƒ¼ãƒ»å ±å‘Šãƒ•ã‚¡ã‚¤ãƒ«ã¯ãã®ã¾ã¾ç¶™ç¶š"
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 3: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–ï¼ˆ--cleanæ™‚ã®ã¿ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if [ "$CLEAN_MODE" = true ]; then
    log_info "ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’åˆæœŸåŒ–ä¸­..."
    TIMESTAMP=$(date "+%Y-%m-%d %H:%M")

    if [ "$LANG_SETTING" = "ja" ]; then
        # æ—¥æœ¬èªã®ã¿
        cat > ./dashboard.md << EOF
# ğŸ“Š ãƒŸãƒƒã‚·ãƒ§ãƒ³çŠ¶æ³
æœ€çµ‚æ›´æ–°: ${TIMESTAMP}

## ğŸš¨ è¦å¯¾å¿œ - King ã®åˆ¤æ–­ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™
ãªã—

## ğŸ”„ é€²è¡Œä¸­ - åªä»Šã€ãƒŸãƒƒã‚·ãƒ§ãƒ³é‚è¡Œä¸­ã§ã™
ãªã—

## âœ… æœ¬æ—¥ã®é”æˆçµæœ
| æ™‚åˆ» | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ä»»å‹™ | çµæœ |
|------|------|------|------|

## ğŸ¯ ã‚¹ã‚­ãƒ«åŒ–å€™è£œ - æ‰¿èªå¾…ã¡
ãªã—

## ğŸ› ï¸ ç”Ÿæˆã•ã‚ŒãŸã‚¹ã‚­ãƒ«
ãªã—

## â¸ï¸ å¾…æ©Ÿä¸­
ãªã—

## â“ ç¢ºèªäº‹é …
ãªã—
EOF
    else
        # æ—¥æœ¬èª + ç¿»è¨³ä½µè¨˜
        cat > ./dashboard.md << EOF
# ğŸ“Š ãƒŸãƒƒã‚·ãƒ§ãƒ³çŠ¶æ³ (Battle Status Report)
æœ€çµ‚æ›´æ–° (Last Updated): ${TIMESTAMP}

## ğŸš¨ è¦å¯¾å¿œ - King ã®åˆ¤æ–­ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ (Action Required - Awaiting Lord's Decision)
ãªã— (None)

## ğŸ”„ é€²è¡Œä¸­ - åªä»Šã€ãƒŸãƒƒã‚·ãƒ§ãƒ³é‚è¡Œä¸­ã§ã™ (In Progress - Currently in Battle)
ãªã— (None)

## âœ… æœ¬æ—¥ã®é”æˆçµæœ (Today's Achievements)
| æ™‚åˆ» (Time) | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (Battlefield) | ä»»å‹™ (Mission) | çµæœ (Result) |
|------|------|------|------|

## ğŸ¯ ã‚¹ã‚­ãƒ«åŒ–å€™è£œ - æ‰¿èªå¾…ã¡ (Skill Candidates - Pending Approval)
ãªã— (None)

## ğŸ› ï¸ ç”Ÿæˆã•ã‚ŒãŸã‚¹ã‚­ãƒ« (Generated Skills)
ãªã— (None)

## â¸ï¸ å¾…æ©Ÿä¸­ (On Standby)
ãªã— (None)

## â“ ç¢ºèªäº‹é … (Questions for Lord)
ãªã— (None)
EOF
    fi

    log_success "  â””â”€ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–å®Œäº† (è¨€èª: $LANG_SETTING, ã‚·ã‚§ãƒ«: $SHELL_SETTING)"
else
    log_info "ğŸ“Š å‰å›ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ç¶­æŒ"
fi
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 4: tmux ã®å­˜åœ¨ç¢ºèª
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if ! command -v tmux &> /dev/null; then
    echo ""
    echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "  â•‘  [ERROR] tmux not found!                              â•‘"
    echo "  â•‘  tmux ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“                                 â•‘"
    echo "  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "  â•‘  Run first_setup.sh first:                            â•‘"
    echo "  â•‘  ã¾ãš first_setup.sh ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:               â•‘"
    echo "  â•‘     ./first_setup.sh                                  â•‘"
    echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    exit 1
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 5: noctis ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆ1ãƒšã‚¤ãƒ³ãƒ»window 0 ã‚’å¿…ãšç¢ºä¿ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
log_war "ğŸ‘‘ Noctisã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ä¸­..."

# noctis ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã‘ã‚Œã°ä½œã‚‹ï¼ˆ-s æ™‚ã‚‚ã“ã“ã§å¿…ãš noctis ãŒå­˜åœ¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰
# window 0 ã®ã¿ä½œæˆã— -n main ã§åå‰ä»˜ã‘ï¼ˆç¬¬äºŒ window ã«ã™ã‚‹ã¨ã‚¢ã‚¿ãƒƒãƒæ™‚ã«ç©ºãƒšã‚¤ãƒ³ãŒé–‹ããŸã‚ 1 window ã«é™å®šï¼‰
if ! tmux has-session -t noctis 2>/dev/null; then
    tmux new-session -d -s noctis -n main -x 200 -y 50
fi

# Noctisãƒšã‚¤ãƒ³ã¯ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å "main" ã§æŒ‡å®šï¼ˆbase-index 1 ç’°å¢ƒã§ã‚‚å‹•ãï¼‰
NOCTIS_PROMPT=$(generate_prompt "Noctis" "magenta" "$SHELL_SETTING")
tmux send-keys -t noctis:main "cd \"$(pwd)\" && export PS1='${NOCTIS_PROMPT}' && clear" Enter
tmux select-pane -t noctis:main -P 'bg=#002b36'  # Noctisã® Solarized Dark
tmux set-option -p -t noctis:main @agent_id "noctis"

log_success "  â””â”€ Noctisã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€æ§‹ç¯‰å®Œäº†"
echo ""

# pane-base-index ã‚’å–å¾—ï¼ˆ1 ã®ç’°å¢ƒã§ã¯ãƒšã‚¤ãƒ³ã¯ 1,2,... ã«ãªã‚‹ï¼‰
PANE_BASE=$(tmux show-options -gv pane-base-index 2>/dev/null || echo 0)
PANE_BASE=${PANE_BASE:-0}  # ç©ºæ–‡å­—åˆ—ã®å ´åˆã¯ 0 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 5.1: kingsglaive ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆ5ãƒšã‚¤ãƒ³ï¼šignis + Comrades 4åï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
log_war "âš”ï¸ Ignisãƒ»Comradesã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ä¸­ï¼ˆ5åé…å‚™ï¼‰..."

# æœ€åˆã®ãƒšã‚¤ãƒ³ä½œæˆ
if ! tmux new-session -d -s kingsglaive -n "agents" -x 200 -y 50 2>/dev/null; then
    echo ""
    echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "  â•‘  [ERROR] Failed to create tmux session 'kingsglaive'      â•‘"
    echo "  â•‘  tmux ã‚»ãƒƒã‚·ãƒ§ãƒ³ 'kingsglaive' ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ       â•‘"
    echo "  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "  â•‘  An existing session may be running.                     â•‘"
    echo "  â•‘  æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ®‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™              â•‘"
    echo "  â•‘                                                          â•‘"
    echo "  â•‘  Check: tmux ls                                          â•‘"
    echo "  â•‘  Kill:  tmux kill-session -t kingsglaive                  â•‘"
    echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    exit 1
fi

# Igniså·¦å´ + Comrades 2x2å³å´ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä½œæˆï¼ˆåˆè¨ˆ5ãƒšã‚¤ãƒ³ï¼‰
# ãƒšã‚¤ãƒ³ç•ªå·ã¯ pane-base-index ã«ä¾å­˜ï¼ˆ0 ã¾ãŸã¯ 1ï¼‰
#
# åˆ†å‰²æˆ¦ç•¥: å…ˆã«3ã‚«ãƒ©ãƒ ã‚’ç¢ºç«‹ â†’ å„ã‚«ãƒ©ãƒ ã‚’ç¸¦åˆ†å‰²
# ã“ã‚Œã«ã‚ˆã‚Š tmux ãƒ„ãƒªãƒ¼ä¸Šã§ä¸­å¤®åˆ—ã¨å³åˆ—ãŒåŒã˜ H-split ã®å…„å¼Ÿã¨ãªã‚Šã€
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã‚‚å¸¸ã«ç­‰å¹…ãŒä¿è¨¼ã•ã‚Œã‚‹
#
# â€» tmux ã¯ãƒšã‚¤ãƒ³ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ãƒ„ãƒªãƒ¼ã®æ·±ã•å„ªå…ˆèµ°æŸ»é †ã§å‰²ã‚Šå½“ã¦ã‚‹ãŸã‚ã€
#    ä¸­å¤®åˆ—ã®å­ãƒšã‚¤ãƒ³ãŒå…ˆã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä»˜ä¸ã•ã‚Œã€å³åˆ—ã¯å¾Œã«ãªã‚‹
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚          â”‚Gladiolus â”‚Lunafreya â”‚
# â”‚  Ignis   â”‚ (idx=1)  â”‚ (idx=3)  â”‚
# â”‚ (idx=0)  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚          â”‚ Prompto  â”‚  Iris    â”‚
# â”‚          â”‚ (idx=2)  â”‚ (idx=4)  â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# Step A: å·¦å³ã«åˆ†å‰²ï¼ˆIgniså·¦å´ / Comradeså³å´ï¼‰â€»å³å´ã«2/3å¹…ã‚’ç¢ºä¿
tmux split-window -h -l 133 -t "kingsglaive:agents"

# Step B: å³å´ã‚’å·¦å³ã«åˆ†å‰²ï¼ˆä¸­å¤®åˆ— / å³åˆ—ï¼‰â†’ 3ã‚«ãƒ©ãƒ ç¢ºç«‹
tmux split-window -h -t "kingsglaive:agents.$((PANE_BASE+1))"

# Step C: ä¸­å¤®åˆ—ã‚’ä¸Šä¸‹ã«åˆ†å‰²ï¼ˆGladiolus / Promptoï¼‰
tmux split-window -v -t "kingsglaive:agents.$((PANE_BASE+1))"

# Step D: å³åˆ—ã‚’ä¸Šä¸‹ã«åˆ†å‰²ï¼ˆLunafreya / Irisï¼‰
# â€» Step C ã®ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚Šå³åˆ—ã¯ idx=PANE_BASE+3 ã«ç§»å‹•
tmux split-window -v -t "kingsglaive:agents.$((PANE_BASE+3))"

# ãƒšã‚¤ãƒ³ãƒ©ãƒ™ãƒ«è¨­å®šï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨: ãƒ¢ãƒ‡ãƒ«åãªã—ï¼‰
# ãƒšã‚¤ãƒ³ãƒ©ãƒ™ãƒ«ï¼ˆtmuxãƒ„ãƒªãƒ¼æ·±ã•å„ªå…ˆèµ°æŸ»é †: idx1=ä¸­å¤®ä¸Š, idx2=ä¸­å¤®ä¸‹, idx3=å³ä¸Š, idx4=å³ä¸‹ï¼‰
PANE_LABELS=("ignis" "gladiolus" "prompto" "lunafreya" "iris")
# ãƒšã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«è¨­å®šï¼ˆtmuxã‚¿ã‚¤ãƒˆãƒ«ç”¨: ãƒ¢ãƒ‡ãƒ«åä»˜ãï¼‰
PANE_TITLES=("ignis(${IGNIS_LABEL})" "gladiolus(${GLADIOLUS_LABEL})" "prompto(${PROMPTO_LABEL})" "lunafreya(${LUNAFREYA_LABEL})" "iris(${IRIS_LABEL})")
# è‰²è¨­å®šï¼ˆignis: èµ¤, comrades: é’ï¼‰
PANE_COLORS=("red" "blue" "blue" "blue" "blue")

AGENT_IDS=("ignis" "gladiolus" "prompto" "lunafreya" "iris")

# ãƒ¢ãƒ‡ãƒ«åè¨­å®šï¼ˆpane-border-format ã§å¸¸æ™‚è¡¨ç¤ºã™ã‚‹ãŸã‚ï¼‰
MODEL_NAMES=("${IGNIS_LABEL}" "${GLADIOLUS_LABEL}" "${PROMPTO_LABEL}" "${LUNAFREYA_LABEL}" "${IRIS_LABEL}")

for i in {0..4}; do
    p=$((PANE_BASE + i))
    tmux select-pane -t "kingsglaive:agents.${p}" -T "${PANE_TITLES[$i]}"
    tmux set-option -p -t "kingsglaive:agents.${p}" @agent_id "${AGENT_IDS[$i]}"
    tmux set-option -p -t "kingsglaive:agents.${p}" @model_name "${MODEL_NAMES[$i]}"
    PROMPT_STR=$(generate_prompt "${PANE_LABELS[$i]}" "${PANE_COLORS[$i]}" "$SHELL_SETTING")
    tmux send-keys -t "kingsglaive:agents.${p}" "cd \"$(pwd)\" && export PS1='${PROMPT_STR}' && clear" Enter
done

# pane-border-format ã§ãƒ¢ãƒ‡ãƒ«åã‚’å¸¸æ™‚è¡¨ç¤ºï¼ˆOpenCode CodeãŒãƒšã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä¸Šæ›¸ãã—ã¦ã‚‚æ¶ˆãˆãªã„ï¼‰
tmux set-option -t kingsglaive -w pane-border-status top
tmux set-option -t kingsglaive -w pane-border-format '#{pane_index} #{@agent_id} (#{?#{==:#{@model_name},},unknown,#{@model_name}})'

log_success "  â””â”€ Ignisãƒ»Comradesã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€æ§‹ç¯‰å®Œäº†"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 6: OpenCode Code èµ·å‹•ï¼ˆ-s / --setup-only ã®ã¨ãã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if [ "$SETUP_ONLY" = false ]; then
    # OpenCode Code CLI ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
    if ! command -v opencode &> /dev/null; then
        log_info "âš ï¸  opencode ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "  first_setup.sh ã‚’å†å®Ÿè¡Œã—ã¦ãã ã•ã„:"
        echo "    ./first_setup.sh"
        exit 1
    fi

    log_war "ğŸ‘‘ å…¨å“¡ã« OpenCode Code ã‚’èµ·å‹•ä¸­..."

    # Noctis
    tmux send-keys -t noctis:main "opencode --model ${NOCTIS_MODEL}"
    tmux send-keys -t noctis:main Enter
    log_info "  â””â”€ Noctisï¼ˆ${NOCTIS_LABEL}ï¼‰ã€èµ·å‹•å®Œäº†"

    # å°‘ã—å¾…æ©Ÿï¼ˆå®‰å®šã®ãŸã‚ï¼‰
    sleep 1

    # Ignisï¼ˆpane 0ï¼‰
    p=$((PANE_BASE + 0))
    tmux send-keys -t "kingsglaive:agents.${p}" "opencode --model ${IGNIS_MODEL}"
    tmux send-keys -t "kingsglaive:agents.${p}" Enter
    log_info "  â””â”€ Ignisï¼ˆ${IGNIS_LABEL}ï¼‰ã€èµ·å‹•å®Œäº†"

    # Gladiolusï¼ˆpane 1ï¼‰
    p=$((PANE_BASE + 1))
    tmux send-keys -t "kingsglaive:agents.${p}" "opencode --model ${GLADIOLUS_MODEL}"
    tmux send-keys -t "kingsglaive:agents.${p}" Enter
    log_info "  â””â”€ Gladiolusï¼ˆ${GLADIOLUS_LABEL}ï¼‰ã€èµ·å‹•å®Œäº†"

    # Promptoï¼ˆpane 2: ä¸­å¤®ä¸‹ï¼‰
    p=$((PANE_BASE + 2))
    tmux send-keys -t "kingsglaive:agents.${p}" "opencode --model ${PROMPTO_MODEL}"
    tmux send-keys -t "kingsglaive:agents.${p}" Enter
    log_info "  â””â”€ Promptoï¼ˆ${PROMPTO_LABEL}ï¼‰ã€èµ·å‹•å®Œäº†"

    # Lunafreyaï¼ˆpane 3: å³ä¸Šï¼‰
    p=$((PANE_BASE + 3))
    tmux send-keys -t "kingsglaive:agents.${p}" "opencode --model ${LUNAFREYA_MODEL}"
    tmux send-keys -t "kingsglaive:agents.${p}" Enter
    log_info "  â””â”€ Lunafreyaï¼ˆ${LUNAFREYA_LABEL}ï¼‰ã€èµ·å‹•å®Œäº†"

    # Irisï¼ˆpane 4ï¼‰
    p=$((PANE_BASE + 4))
    tmux send-keys -t "kingsglaive:agents.${p}" "opencode --model ${IRIS_MODEL}"
    tmux send-keys -t "kingsglaive:agents.${p}" Enter
    log_info "  â””â”€ Irisï¼ˆ${IRIS_LABEL}ï¼‰ã€èµ·å‹•å®Œäº†"

    log_success "âœ… ${MODE_NAME}ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆNoctis: ${NOCTIS_LABEL}, Ignis: ${IGNIS_LABEL}, Gladiolus: ${GLADIOLUS_LABEL}, Prompto: ${PROMPTO_LABEL}, Lunafreya: ${LUNAFREYA_LABEL}, Iris: ${IRIS_LABEL}ï¼‰"
    echo ""

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # STEP 6.5: å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æŒ‡ç¤ºæ›¸ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    log_war "ğŸ“œ å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æŒ‡ç¤ºæ›¸ã‚’èª­ã¿è¾¼ã¾ã›ä¸­..."
    echo ""

    echo "  OpenCode Code ã®èµ·å‹•ã‚’å¾…æ©Ÿä¸­ï¼ˆæœ€å¤§30ç§’ï¼‰..."

    # Noctisã®èµ·å‹•ã‚’ç¢ºèªï¼ˆæœ€å¤§30ç§’å¾…æ©Ÿï¼‰
    for i in {1..30}; do
        if tmux capture-pane -t noctis:main -p | grep -q "bypass permissions"; then
            echo "  â””â”€ Noctisã® OpenCode Code èµ·å‹•ç¢ºèªå®Œäº†ï¼ˆ${i}ç§’ï¼‰"
            break
        fi
        sleep 1
    done

    # Noctisã«æŒ‡ç¤ºæ›¸ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹
    log_info "  â””â”€ Noctisã«æŒ‡ç¤ºæ›¸ã‚’ä¼é”ä¸­..."
    tmux send-keys -t noctis:main "instructions/noctis.md ã‚’èª­ã‚“ã§å½¹å‰²ã‚’ç†è§£ã—ã¦ãã‚Œã€‚"
    sleep 0.5
    tmux send-keys -t noctis:main Enter

    # Ignisã«æŒ‡ç¤ºæ›¸ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹
    sleep 2
    log_info "  â””â”€ Ignisã«æŒ‡ç¤ºæ›¸ã‚’ä¼é”ä¸­..."
    tmux send-keys -t "kingsglaive:agents.${PANE_BASE}" "instructions/ignis.md ã‚’èª­ã‚“ã§å½¹å‰²ã‚’ç†è§£ã—ã¦ãã‚Œã€‚"
    sleep 0.5
    tmux send-keys -t "kingsglaive:agents.${PANE_BASE}" Enter

    # Comradesã«æŒ‡ç¤ºæ›¸ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹
    sleep 2
    log_info "  â””â”€ Comradesã«æŒ‡ç¤ºæ›¸ã‚’ä¼é”ä¸­..."
    WORKER_NAMES=("gladiolus" "prompto" "lunafreya" "iris")
    WORKER_LABELS=("Gladiolusï¼ˆã‚°ãƒ©ãƒ‡ã‚£ã‚ªãƒ©ã‚¹ï¼‰" "Promptoï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰" "Lunafreyaï¼ˆãƒ«ãƒŠãƒ•ãƒ¬ãƒ¼ãƒŠï¼‰" "Irisï¼ˆã‚¤ãƒªã‚¹ï¼‰")
    for i in {0..3}; do
        p=$((PANE_BASE + 1 + i))
        tmux send-keys -t "kingsglaive:agents.${p}" "instructions/comrades.md ã‚’èª­ã‚“ã§å½¹å‰²ã‚’ç†è§£ã—ã¦ãã ã•ã„ã€‚ã‚ãªãŸã¯${WORKER_LABELS[$i]}ã§ã™ã€‚"
        sleep 0.3
        tmux send-keys -t "kingsglaive:agents.${p}" Enter
        sleep 0.5
    done

    log_success "âœ… å…¨å“¡ã«æŒ‡ç¤ºæ›¸ä¼é”å®Œäº†"
    echo ""
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 7: ç’°å¢ƒç¢ºèªãƒ»å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
log_info "ğŸ” ãƒ‘ãƒ¼ãƒ†ã‚£ã‚’ç¢ºèªä¸­..."
echo ""
echo "  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "  â”‚  ğŸ“º Tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ (Sessions)                                  â”‚"
echo "  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
tmux list-sessions | sed 's/^/     /'
echo ""
echo "  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "  â”‚  ğŸ“‹ ãƒ‘ãƒ¼ãƒ†ã‚£ç·¨æˆ (Formation)                                   â”‚"
echo "  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "     ã€noctisã‚»ãƒƒã‚·ãƒ§ãƒ³ã€‘Noctisã®ã‚»ãƒƒã‚·ãƒ§ãƒ³"
echo "     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "     â”‚  Pane 0: Noctis (NOCTIS)      â”‚  â† Princeãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±æ‹¬"
echo "     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "     ã€kingsglaiveã‚»ãƒƒã‚·ãƒ§ãƒ³ã€‘Ignisãƒ»Comradesã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆ5ãƒšã‚¤ãƒ³ï¼‰"
echo "     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "     â”‚          â”‚Gladiolus â”‚Lunafreya â”‚"
echo "     â”‚  Ignis   â”‚  (ç›¾)    â”‚  (ç¥å‡ª)  â”‚"
echo "     â”‚  ç®¡ç†    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
echo "     â”‚          â”‚ Prompto  â”‚  Iris    â”‚"
echo "     â”‚          â”‚  (éŠƒ)    â”‚  (èŠ±)    â”‚"
echo "     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

echo ""
echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "  â•‘  âš”ï¸ å‡ºç™ºæº–å‚™å®Œäº†ï¼Stand by Meï¼                              â•‘"
echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

if [ "$SETUP_ONLY" = true ]; then
    echo "  âš ï¸  ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ã¿ãƒ¢ãƒ¼ãƒ‰: OpenCode Codeã¯æœªèµ·å‹•ã§ã™"
    echo ""
    echo "  æ‰‹å‹•ã§OpenCodeã‚’èµ·å‹•ã™ã‚‹ã«ã¯:"
    echo "  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
    echo "  â”‚  # Noctisã‚’èµ·å‹•                                            â”‚"
    echo "  â”‚  tmux send-keys -t noctis:main \                         â”‚"
    echo "  â”‚    'opencode' Enter                                      â”‚"
    echo "  â”‚                                                          â”‚"
    echo "  â”‚  # Ignisãƒ»Comradesã‚’ä¸€æ–‰èµ·å‹•                                      â”‚"
    echo "  â”‚  for p in \$(seq $PANE_BASE $((PANE_BASE+4))); do         â”‚"
    echo "  â”‚      tmux send-keys -t kingsglaive:agents.\$p \           â”‚"
    echo "  â”‚      'opencode' Enter                                    â”‚"
    echo "  â”‚  done                                                    â”‚"
    echo "  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
    echo ""
fi

echo "  æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo "  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "  â”‚  Noctisã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¿ãƒƒãƒã—ã¦å‘½ä»¤ã‚’é–‹å§‹:                      â”‚"
echo "  â”‚     tmux attach-session -t noctis   (ã¾ãŸã¯: css)        â”‚"
echo "  â”‚                                                          â”‚"
echo "  â”‚  Ignisãƒ»Comradesã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹:                                    â”‚"
echo "  â”‚     tmux attach-session -t kingsglaive   (ã¾ãŸã¯: csm)    â”‚"
echo "  â”‚                                                          â”‚"
echo "  â”‚  â€» å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯æŒ‡ç¤ºæ›¸ã‚’èª­ã¿è¾¼ã¿æ¸ˆã¿ã€‚                 â”‚"
echo "  â”‚    ã™ãã«å‘½ä»¤ã‚’é–‹å§‹ã§ãã¾ã™ã€‚                             â”‚"
echo "  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "   Stand by Meï¼ä»²é–“ã¨ã¨ã‚‚ã«ï¼ (Stand by Me! Seize victory!)"
echo "  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STEP 8: Windows Terminal ã§ã‚¿ãƒ–ã‚’é–‹ãï¼ˆ-t ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ™‚ã®ã¿ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if [ "$OPEN_TERMINAL" = true ]; then
    log_info "ğŸ“º Windows Terminal ã§ã‚¿ãƒ–ã‚’å±•é–‹ä¸­..."

    # Windows Terminal ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
    if command -v wt.exe &> /dev/null; then
        wt.exe -w 0 new-tab wsl.exe -e bash -c "tmux attach-session -t noctis" \; new-tab wsl.exe -e bash -c "tmux attach-session -t kingsglaive"
        log_success "  â””â”€ ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¿ãƒ–å±•é–‹å®Œäº†"
    else
        log_info "  â””â”€ wt.exe ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æ‰‹å‹•ã§ã‚¢ã‚¿ãƒƒãƒã—ã¦ãã ã•ã„ã€‚"
    fi
    echo ""
fi
